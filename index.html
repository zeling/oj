<html>

<head>
    <style>
        body {
            overflow: hidden;
        }

        #group {
            width: 250px;
            height: 800px;
            margin: 400px auto;
        }

        .digit {
            width: 50px;
            height: 50px;
            margin: 0px 3px;
            border: 3px;
            border-style: solid;
            border-color: black;
            border-radius: 3px;
            float: left;
            color: white;
            background-color: black;
        }

        .digit p {
            height: 30px;
            width: 30px;
            margin: 10px auto;
            font-size: 30px;
            padding: 0px 15px;
        }

        .focus {
            border-color: mediumturquoise;
            background-color: mediumturquoise;
        }

        #group button {
            border: none;
            margin: 50px 50px;
            height: 50px;
            width: 150px;
            border-radius: 30px;
            font-size: 20px;
            background-color: mediumturquoise;
            color: white;
        }

        canvas {
            width: 1280px;
            margin: 0px auto;
            display: block;
        }

    </style>
</head>

<body>
    <div id="group">
        <div class="digit focus">
            <p>0</p>
        </div>
        <div class="digit">
            <p>0</p>
        </div>
        <div class="digit">
            <p>0</p>
        </div>
        <div class="digit">
            <p>0</p>
        </div>
        <button>&lt;3</button>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>
<script>
    /* code credit to hackerzhou, https://github.com/hackerzhou/love */
    function Vector(x, y) {
        this.x = x;
        this.y = y;
    };

    Vector.prototype = {
        rotate: function (theta) {
            var x = this.x;
            var y = this.y;
            this.x = Math.cos(theta) * x - Math.sin(theta) * y;
            this.y = Math.sin(theta) * x + Math.cos(theta) * y;
            return this;
        },
        mult: function (f) {
            this.x *= f;
            this.y *= f;
            return this;
        },
        clone: function () {
            return new Vector(this.x, this.y);
        },
        length: function () {
            return Math.sqrt(this.x * this.x + this.y * this.y);
        },
        subtract: function (v) {
            this.x -= v.x;
            this.y -= v.y;
            return this;
        },
        set: function (x, y) {
            this.x = x;
            this.y = y;
            return this;
        }
    };

    function Petal(stretchA, stretchB, startAngle, angle, growFactor, bloom) {
        this.stretchA = stretchA;
        this.stretchB = stretchB;
        this.startAngle = startAngle;
        this.angle = angle;
        this.bloom = bloom;
        this.growFactor = growFactor;
        this.r = 1;
        this.isfinished = false;
        //this.tanAngleA = Garden.random(-Garden.degrad(Garden.options.tanAngle), Garden.degrad(Garden.options.tanAngle));
        //this.tanAngleB = Garden.random(-Garden.degrad(Garden.options.tanAngle), Garden.degrad(Garden.options.tanAngle));
    }
    Petal.prototype = {
        draw: function () {
            var ctx = this.bloom.garden.ctx;
            var v1, v2, v3, v4;
            v1 = new Vector(0, this.r).rotate(Garden.degrad(this.startAngle));
            v2 = v1.clone().rotate(Garden.degrad(this.angle));
            v3 = v1.clone().mult(this.stretchA); //.rotate(this.tanAngleA);
            v4 = v2.clone().mult(this.stretchB); //.rotate(this.tanAngleB);
            ctx.strokeStyle = this.bloom.c;
            ctx.beginPath();
            ctx.moveTo(v1.x, v1.y);
            ctx.bezierCurveTo(v3.x, v3.y, v4.x, v4.y, v2.x, v2.y);
            ctx.stroke();
        },
        render: function () {
            if (this.r <= this.bloom.r) {
                this.r += this.growFactor; // / 10;
                this.draw();
            } else {
                this.isfinished = true;
            }
        }
    }

    function Bloom(p, r, c, pc, garden) {
        this.p = p;
        this.r = r;
        this.c = c;
        this.pc = pc;
        this.petals = [];
        this.garden = garden;
        this.init();
        this.garden.addBloom(this);
    }
    Bloom.prototype = {
        draw: function () {
            var p, isfinished = true;
            this.garden.ctx.save();
            this.garden.ctx.translate(this.p.x, this.p.y);
            for (var i = 0; i < this.petals.length; i++) {
                p = this.petals[i];
                p.render();
                isfinished *= p.isfinished;
            }
            this.garden.ctx.restore();
            if (isfinished == true) {
                this.garden.removeBloom(this);
            }
        },
        init: function () {
            var angle = 360 / this.pc;
            var startAngle = Garden.randomInt(0, 90);
            for (var i = 0; i < this.pc; i++) {
                this.petals.push(new Petal(Garden.random(Garden.options.petalStretch.min, Garden.options.petalStretch.max), Garden.random(Garden.options.petalStretch.min, Garden.options.petalStretch.max), startAngle + i * angle, angle, Garden.random(Garden.options.growFactor.min, Garden.options.growFactor.max), this));
            }
        }
    }

    function Garden(ctx, element) {
        this.blooms = [];
        this.element = element;
        this.ctx = ctx;
    }
    Garden.prototype = {
        render: function () {
            for (var i = 0; i < this.blooms.length; i++) {
                this.blooms[i].draw();
            }
        },
        addBloom: function (b) {
            this.blooms.push(b);
        },
        removeBloom: function (b) {
            var bloom;
            for (var i = 0; i < this.blooms.length; i++) {
                bloom = this.blooms[i];
                if (bloom === b) {
                    this.blooms.splice(i, 1);
                    return this;
                }
            }
        },
        createRandomBloom: function (x, y) {
            this.createBloom(x, y, Garden.randomInt(Garden.options.bloomRadius.min, Garden.options.bloomRadius.max), Garden.randomrgba(Garden.options.color.rmin, Garden.options.color.rmax, Garden.options.color.gmin, Garden.options.color.gmax, Garden.options.color.bmin, Garden.options.color.bmax, Garden.options.color.opacity), Garden.randomInt(Garden.options.petalCount.min, Garden.options.petalCount.max));
        },
        createBloom: function (x, y, r, c, pc) {
            new Bloom(new Vector(x, y), r, c, pc, this);
        },
        clear: function () {
            this.blooms = [];
            this.ctx.clearRect(0, 0, this.element.width, this.element.height);
        }
    }

    Garden.options = {
        petalCount: {
            min: 8,
            max: 15
        },
        petalStretch: {
            min: 0.1,
            max: 3
        },
        growFactor: {
            min: 0.1,
            max: 1
        },
        bloomRadius: {
            min: 8,
            max: 10
        },
        density: 10,
        growSpeed: 1000 / 60,
        color: {
            rmin: 128,
            rmax: 255,
            gmin: 0,
            gmax: 128,
            bmin: 0,
            bmax: 128,
            opacity: 0.1
        },
        tanAngle: 60
    };
    Garden.random = function (min, max) {
        return Math.random() * (max - min) + min;
    };
    Garden.randomInt = function (min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    };
    Garden.circle = 2 * Math.PI;
    Garden.degrad = function (angle) {
        return Garden.circle / 360 * angle;
    };
    Garden.raddeg = function (angle) {
        return angle / Garden.circle * 360;
    };
    Garden.rgba = function (r, g, b, a) {
        return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';
    };
    Garden.randomrgba = function (rmin, rmax, gmin, gmax, bmin, bmax, a) {
        var r = Math.round(Garden.random(rmin, rmax));
        var g = Math.round(Garden.random(gmin, gmax));
        var b = Math.round(Garden.random(bmin, bmax));
        var limit = 5;
        if (Math.abs(r - g) <= limit && Math.abs(g - b) <= limit && Math.abs(b - r) <= limit) {
            return Garden.rgba(rmin, rmax, gmin, gmax, bmin, bmax, a);
        } else {
            return Garden.rgba(r, g, b, a);
        }
    };
</script>
<script>
    $(function () {
        
        
        var focused = $('.focus');
        function setFocused(el) {
            focused.removeClass('focus');
            focused = $(el);
            while (!focused.hasClass('digit')) focused = focused.parent();
            focused.addClass('focus');
        }

        $group = $('#group');
        $button = $('#group button');

        $('.digit').mousewheel(function (event) {
            event.preventDefault()
            setFocused(event.target);
            var el = event.target;
            if (el.tagName !== 'P') el = el.children[0];
            var val = parseInt(el.innerText);
            val = Math.floor(val + event.deltaY);
            while (val > 9) val -= 10;
            while (val < 0) val += 10;
            el.innerText = "" + val;
        });

        $(window).keydown(function(event) {
            if (event.which <= 57 && event.which >= 48) {
                focused.children()[0].innerText = String.fromCharCode(event.which);
            }
        });

        $('#group button').click(function () {
            var digits = $('.digit');
            if (digits[0].innerText[0] == '0' && digits[1].innerText[0] == '5' && digits[2].innerText[0] == '2' && digits[3].innerText[0] == '2') {
                $('#group').fadeOut(2000, function() {
                    
                    $('body')[0].innerHTML = '<canvas width="1280" height="728"></canvas>';
                    var canvas = document.querySelector('canvas');
                    var ctx = canvas.getContext('2d');
                    var w = canvas.width, h = canvas.height;
                    
                    ctx.globalCompositeOperation = 'lighter';

                    var garden = new Garden(ctx, canvas);

                    function getCharRep(ch) {
                        ctx.font = "12px Arial";
                        ctx.clearRect(0, 0, w, h);
                        ctx.fillText(ch, 0, 12);
                        data32 = new Uint32Array(ctx.getImageData(0, 0, w, h).data.buffer);
                        ret = [];
                        var radius = Garden.options.bloomRadius.max * 1.3;
                        for (var i = 0; i < data32.length; i++) {
                            if (data32[i] & 0xff000000) {
                                ret.push({
                                    x: (i % w) * radius * 2 + radius,
                                    y: ((i / w) | 0) * radius * 2 + radius
                                });
                            }
                        }
                        ctx.clearRect(0, 0, w, h);
                        return ret;
                    }
                    
                    var irep = getCharRep('I');
                    var prep = getCharRep('P');

                    setInterval(function () {
                        garden.render();
                    }, Garden.options.growSpeed);

                    function drawChar(rep, offx, offy, cb) {
                        var i = 0;
                        var timer = setInterval(function() {
                           if (i == rep.length) {
                               clearInterval(timer);
                               if (cb) cb();
                           } else {
                               console.log(rep[i].x + offx, rep[i].y + offy);
                               garden.createRandomBloom(rep[i].x + offx, rep[i].y + offy);
                               i++;
                           }
                        }, 100);
                    }

                    function drawHeart(offx, offy, scale, cb) {
                        var theta = 0.0;
                        var points = [];
                        var timer = setInterval(function() {
                            var p = heartCoord(theta, offx, offy, scale);
                            console.log(theta, p);
                            var draw = true;
                            for (var i = 0; i < points.length; i++) {
                                var o = points[i];
                                var d = Math.pow(o.x - p.x, 2) + Math.pow(o.y - p.y, 2);
                                if (d < Math.pow(Garden.options.bloomRadius.max * 1.3, 2)) {
                                    draw = false;
                                    break;
                                }
                            }
                            if (draw) {
                                points.push(p);
                                garden.createRandomBloom(p.x, p.y);
                            }
                            if (theta >= 20) {
                                clearInterval(timer);
                                if (cb) cb();
                            } else {
                                theta += 0.2;
                            }
                        }, 50);
                    }
                

                    drawChar(irep, 200, 200, function() {
                        drawHeart(500, 375, 10, function() {
                            drawChar(prep, 700, 200, function() {
                                drawChar(prep, 900, 200);
                            });
                        });
                    });


                });
            }
        });


        function heartCoord(theta, offX, offY, scale) {
            var t = theta / Math.PI;
            return {
                x: offX + scale * (16 * Math.pow(Math.sin(t), 3)),
                y: offY - scale * (13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t))
            };
        }

    });

</script>
</html>